<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript">
			(new class Main {
				Socket = null;
				
				constructor() {
					console.log('Main');
					
					[
						'connectSocket',
						'connectSDSocket',
						'connectMiraBoxSDSocket',
						'connectElgatoStreamDeckSocket',
					].forEach((name) => {
						window[name] = this.connect.bind(this);
					});
				}
				
				connect(port, uuid, event, info) {
					console.log('connect', arguments);
					
					this.Socket = new WebSocket('ws://127.0.0.1:' + port);
					
					this.Socket.addEventListener('open',	() => this.onConnect(port, uuid, event));
					this.Socket.addEventListener('message',	this.onReceive.bind(this));
					this.Socket.addEventListener('close',	this.onClose.bind(this));
					this.Socket.addEventListener('error',	this.onError.bind(this));
				}
				
				send(data) {
					console.warn('[Send]', data);
					this.Socket.send(JSON.stringify(data));
				}
				
				onConnect(port, uuid, event) {
					console.warn('[Connect]', { event: event, uuid: uuid });
					this.send({ event: event, uuid: uuid });
				}
				
				onClose(event) {
					console.warn('[Close]', event);
				}
				
				onError(event) {
					console.error('[Error]', event, event.data);
				}
				
				onReceive(event) {
					let packet = JSON.parse(event.data);
					console.log('[Receive]', packet.action, packet.event, packet);
				}
			}());
		</script>
	</head>
	<body></body>
</html>